<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
        <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
        <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.form/4.3.0/jquery.form.min.js" integrity="sha384-qlmct0AOBiA2VPZkMY3+2WqkHtIQ9lSdAsAn5RUJD/3vA5MKDgSGcdmIv4ycVxyn" crossorigin="anonymous"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>3D Point Cloud Generation</title>
    </head>
    <body>
        <div class="headBar">
            <div class="title" style="clear: both">
            <h1 style="float: left" ><a href= "https://www.ogc.org/standards/wps"><b>WPS</b></a></h1>
            <h1 style="float: right" ><img src="{{url_for('static', filename='images/mapmint.jpg')}}" style="width:45px;height:45px;" alt=""><a href="http://mapmint.com/"><span style="color: #707070;"><b>Map</b></span><span style="color: #83c849"><b>Mint</b></span></a></h1>
            </div>
        </div>
        <hr/>
        <br/>
        <div class="container">
            <div class="panel panel-default">
                <div class="panel-heading"><b>3D Point Cloud Generation</b></div>
                <div class="panel-body">
                    <p>Accepted file extensions are: <b>jpg, jpeg, png, bmp, tiff, tif</b></p>
                    <p><b>Note</b>: It might take a while to run 3D reconstruction on your images, so please be patient and only click upload once :)</p>
                    <form id="uploadImage" action="/" enctype="multipart/form-data" method="POST">
                        <div class="form-group">
                            <label>File Upload</label>
                            <input type="file" name="files[]" id="uploadFile" multiple="true" autocomplete="off" required/>
                        </div>
                        <div class="form-group">
                            <!-- <input type="submit" id="uploadSubmit" value="Upload" class="btn btn-info" /> -->
                            <button type="submit" id="uploadSubmit" class="btn btn-info">Upload</button>
                        </div>
                        <div class="progress">
                            <div class="progress-bar progress-bar-striped bg-success" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <div id="targetLayer" style="display:none;"></div>
                    </form>
                    <div id="loader-icon" style="display:none;"><img src="/static/images/loader.gif" /></div>
                    <div id="show-status" style="display:none;"><p><b>Point Cloud Created Successfully!</b></p></div>
                    <div id="downloadPLYfile" style="display:none;" class="inline">
                        <a href="/data/sample/undistorted/depthmaps/merged.ply" download><button type="button" class="btn btn-info">Download Point Cloud</button></a>
                    </div>
                    <div id="visualize" style="display:none;" class="inline">
                        <a href=result><button type="button" id="visualize" class="btn btn-info">Visualize</button></a>
                    </div>       
                    <div id="openPotree" style="display:none;" class="inline">
                        <button type="button"  class="btn btn-info">Open Potree</button>
                    </div>
                </div>
            </div>
        </div> 
        <script>
        $(document).ready(function(){
            $('#uploadImage').submit(function(event){
                if($('#uploadFile').val()){
                    event.preventDefault();
                    $('#loader-icon').show();    
                    $('#show-status').hide();
                    $('#downloadPLYfile').hide();
                    $('#visualize').hide();
                    $('#openPotree').hide();
                    $('#targetLayer').hide();
                    $(this).ajaxSubmit({
                        target: '#targetLayer',
                        beforeSubmit:function(){
                            $('.progress-bar').width('%');
                        },
                        uploadProgress: function(event, position, total, percentageComplete)
                        {
                            $('.progress-bar').animate({
                                width: percentageComplete + '%'
                            }, {
                                duration: 1000
                            });
                        },
                        success:function(data){
                            $('#loader-icon').hide();
                            $('#show-status').show();
                            $('#downloadPLYfile').show();
                            $('#visualize').show();
                            $('#openPotree').show();
                            $('#targetLayer').show();
                            $('#targetLayer').append(data.htmlresponse);
                        },
                        resetForm: true
                    });
                }
                return false;
            });
        });
        </script>
    </body>
</html>
